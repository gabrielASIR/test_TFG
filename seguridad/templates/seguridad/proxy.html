<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuración de Proxy con Squid</title>
</head>
<body>
    <h1>Configuración de Proxy con Squid</h1>
    <p>Además de controlar los paquetes que viajan por toda nuestra estructura, podemos controlar qué paquetes se envían y llegan a partir de Internet.
    Si queremos que un usuario no pueda acceder a ciertos sitios, al igual que sí que acceda a otros, todo podremos controlarlo a través del Proxy. 
    Específicamente, a través de Squid debido al amplio abanico de posibilidades que nos ofrece.</p><br>
    <p>Es especialmente utilizado para empresas o ciertas estructuras, de tal manera que sus usuarios tengan un "perímetro" justo con el que trabajar.</p><br><br>
    <form method="post">
        {% csrf_token %}
        <label for="ruta_configuracion">Ruta de Configuración:</label><br>
        <input type="text" id="ruta_configuracion" name="ruta_configuracion"
            placeholder="Ej: /etc/squid/conf.d/squid-custom.conf"><br><br>

        <label for="num_reglas">Número de Reglas:</label><br>
        <input type="number" id="num_reglas" name="num_reglas" min="1" value="1" placeholder="Número de reglas"><br><br>


        <div id="reglas">
            <div class="regla">
                <fieldset>
                    <legend>Regla de configuracion</legend>
                    <label for="tipo_regla_1">Tipo de Regla:</label><br>
                    <select id="tipo_regla_1" name="tipo_regla_1" onchange="toggleCampos(1)">
                        <option value="acl">ACL</option>
                        <option value="http_access">HTTP Access</option>
                    </select><br><br>

                    <label for="acl_1">ACL:</label><br>
                    <input type="text" id="acl_1" name="acl_1" placeholder="Ej: acl"><br><br>

                    <label for="tipo_acl_1">Tipo de ACL:</label><br>
                    <select id="tipo_acl_1" name="tipo_acl_1">
                        <option value="src">Origen (src)</option>
                        <option value="dst">Destino (dst)</option>
                        <option value="dstdomain">Dominio de Destino (dstdomain)</option>
                        <option value="url_regex">Expresión Regular de URL (url_regex)</option>
                        <option value="time">Tiempo (time)</option>
                        <option value="urlpath_regex">Expresión Regular de Ruta de URL (urlpath_regex)</option>
                        <option value="port">Puerto (port)</option>
                        <option value="proxy_auth">Autenticación de Proxy (proxy_auth)</option>
                    </select><br><br>

                    <label for="http_access_1">HTTP Access:</label><br>
                    <input type="text" id="http_access_1" name="http_access_1" placeholder="Ej: http_access"><br><br>

                    <label for="accion_http_access_1">Acción HTTP Access:</label><br>
                    <select id="accion_http_access_1" name="accion_http_access_1">
                        <option value="allow">Allow</option>
                        <option value="deny">Deny</option>
                    </select><br><br>

                    <button type="button" onclick="eliminarRegla(this)">Eliminar Regla</button>
                </fieldset>
            </div>
        </div>

        <!-- Botón para agregar más reglas -->
        <button type="button" onclick="agregarRegla()">Agregar Regla</button><br><br>

        <!-- Botón para enviar el formulario -->
        <button type="submit">Aplicar Configuración</button>
    </form>

    <script>
        function agregarRegla() {
            const numReglas = document.querySelectorAll('.regla').length + 1;
            const reglasDiv = document.getElementById('reglas');
            const nuevaRegla = document.createElement('div');
            nuevaRegla.className = 'regla';
            nuevaRegla.innerHTML = `
            <fieldset>
                <legend>Regla de configuracion</legend>
                <label for="tipo_regla_${numReglas}">Tipo de Regla:</label><br>
                <select id="tipo_regla_${numReglas}" name="tipo_regla_${numReglas}" onchange="toggleCampos(${numReglas})">
                    <option value="acl">ACL</option>
                    <option value="http_access">HTTP Access</option>
                </select><br><br>

                <label for="acl_${numReglas}">ACL:</label><br>
                <input type="text" id="acl_${numReglas}" name="acl_${numReglas}" placeholder="Ej: acl"><br><br>
                
                <label for="tipo_acl_${numReglas}">Tipo de ACL:</label><br>
                <select id="tipo_acl_${numReglas}" name="tipo_acl_${numReglas}">
                    <option value="src">Origen (src)</option>
                    <option value="dst">Destino (dst)</option>
                    <option value="dstdomain">Dominio de Destino (dstdomain)</option>
                    <option value="url_regex">Expresión Regular de URL (url_regex)</option>
                    <option value="time">Tiempo (time)</option>
                    <option value="urlpath_regex">Expresión Regular de Ruta de URL (urlpath_regex)</option>
                    <option value="port">Puerto (port)</option>
                    <option value="proxy_auth">Autenticación de Proxy (proxy_auth)</option>
                    </select><br><br>

                <label for="http_access_${numReglas}">HTTP Access:</label><br>
                <input type="text" id="http_access_${numReglas}" name="http_access_${numReglas}" placeholder="Ej: http_access"><br><br>

                <label for="accion_http_access_${numReglas}">Acción HTTP Access:</label><br>
                <select id="accion_http_access_${numReglas}" name="accion_http_access_${numReglas}">
                    <option value="allow">Allow</option>
                    <option value="deny">Deny</option>
                </select><br><br>

                <button type="button" onclick="eliminarRegla(this)">Eliminar Regla</button>
            </fieldset>
            `;
            reglasDiv.appendChild(nuevaRegla);
        }

        function eliminarRegla(button) {
            button.closest('.regla').remove();
        }

        function toggleCampos(numRegla) {
            const tipoRegla = document.getElementById(`tipo_regla_${numRegla}`).value;
            const aclInput = document.getElementById(`acl_${numRegla}`);
            const tipoAclSelect = document.getElementById(`tipo_acl_${numRegla}`);
            const httpAccessInput = document.getElementById(`http_access_${numRegla}`);
            const accionHttpAccessSelect = document.getElementById(`accion_http_access_${numRegla}`);

            if (tipoRegla === 'acl') {
                aclInput.style.display = 'block';
                tipoAclSelect.style.display = 'block';
                httpAccessInput.style.display = 'none';
                accionHttpAccessSelect.style.display = 'none';
            } else {
                aclInput.style.display = 'none';
                tipoAclSelect.style.display = 'none';
                httpAccessInput.style.display = 'block';
                accionHttpAccessSelect.style.display = 'block';
            }
        }
    </script>
</body>
</html>
